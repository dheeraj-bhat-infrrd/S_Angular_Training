<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/security
			http://www.springframework.org/schema/security/spring-security.xsd">

	<http use-expressions="true" auto-config="true" entry-point-ref="customEntryPoint"
		authentication-manager-ref="authenticationManager">
		<!-- Generic Services -->
		<intercept-url pattern="/" access="permitAll" />
		<intercept-url pattern="/home.do" access="permitAll" />
		<intercept-url pattern="/index.do" access="permitAll" />
		<intercept-url pattern="/login.do" access="permitAll" />
		<intercept-url pattern="/signup.do" access="permitAll" />
		<intercept-url pattern="/errorpage.do" access="permitAll" />	
		<intercept-url pattern="/fetchgatrackingid.do" access="permitAll" />
		<intercept-url pattern="/fetchgooglemapapikey.do" access="permitAll" />
		<intercept-url pattern="/redirectifexistsactivesession.do" access="permitAll" />

		<!-- FindAPro Services -->
		<intercept-url pattern="/initfindapro.do" access="permitAll" />
		<intercept-url pattern="/findapro.do" access="permitAll" />
		<intercept-url pattern="/findaproscroll.do" access="permitAll" />
		
		<!-- Search Engine Services-->
		<!-- <intercept-url pattern="/showsearchenginepage.do" access="permitAll" /> -->
		<intercept-url pattern="/searchengine/*.do" access="permitAll" />
		
		<!-- Page not found -->
		<intercept-url pattern="/sspagenotfound.do" access="permitAll" />
		
		<!-- Company list page -->
		<intercept-url pattern="/findcompany.do" access="permitAll" />
		
		<!-- Registration Services -->
		<intercept-url pattern="/resendRegistrationMail.do" access="permitAll" />
		<intercept-url pattern="/generateregistrationurl.do" access="permitAll" />
		<intercept-url pattern="/invitetoregister.do" access="permitAll" />
		
		<intercept-url pattern="/showcompleteregistrationpage.do" access="permitAll" />
		<intercept-url pattern="/completeregistrationpage.do" access="permitAll" />
		<intercept-url pattern="/completeregistration.do" access="permitAll" />
		
		<intercept-url pattern="/registration.do" access="permitAll" />
		<intercept-url pattern="/showregistrationpage.do" access="permitAll" />
		<intercept-url pattern="/registrationpage.do" access="permitAll" />
		<intercept-url pattern="/register.do" access="permitAll" />
		<intercept-url pattern="/accountsignup.do" access="permitAll" />
		<intercept-url pattern="/accountsignupredirect.do" access="permitAll" />
		
		<!-- Mail URL Resolver Services -->
		<intercept-url pattern="/mail.do" access="permitAll" />

		<!-- ForgotPassword Services -->
		<intercept-url pattern="/forgotPassword.do" access="permitAll" />
		<intercept-url pattern="/sendresetpasswordlink.do" access="permitAll" />
		<intercept-url pattern="/resetpassword.do" access="permitAll" />
		<intercept-url pattern="/setnewpassword.do" access="permitAll" />

		<!-- Email Verification -->
		<intercept-url pattern="/emailverification.do" access="permitAll" />
		
		<!-- Admin pages -->
		<intercept-url pattern="/adminlogin.do" access="permitAll" />
		
		<!--  generate api key -->
		<intercept-url pattern="/generateApiKey.do" access="permitAll" />

		<!-- Registration urls -->
		<intercept-url pattern="registeraccount/*.do" access="permitAll" />
		<intercept-url pattern="/newlogin.do" access="permitAll" />
		
		<!-- Restricted Services -->
		<intercept-url pattern="/*.do" access="isAuthenticated()" />
		<form-login login-page="/"
			authentication-failure-url="/login.do?s=autherror"
			authentication-success-handler-ref="userLoginHandler" />

		<session-management session-fixation-protection="newSession">
			<concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
		</session-management>

		<!-- Logout Services -->
		<logout invalidate-session="true" logout-success-url="/login.do?s=logout" />
		<custom-filter ref="logoutFilter" before="LOGOUT_FILTER" />
	</http>
	
	<beans:bean id="customEntryPoint"
		class="com.realtech.socialsurvey.web.security.AjaxAwareLoginUrlAuthenticationEntryPoint">
		<beans:constructor-arg value="/login.do?s=sessionerror" />
	</beans:bean>

	<authentication-manager alias="authenticationManager">
		<authentication-provider ref='socialsurveyAuthenticationProvider' />
	</authentication-manager>

	<beans:bean id='userRepository'
		class='com.realtech.socialsurvey.web.security.UserRepositoryService' />
	<beans:bean id='socialsurveyAuthenticationProvider'
		class='com.realtech.socialsurvey.web.security.UserAuthProvider'>
		<beans:property name="userDetailsService" ref="userRepository" />
	</beans:bean>

	<beans:bean id="logoutFilter"
		class="org.springframework.security.web.authentication.logout.LogoutFilter">
		<beans:constructor-arg index="0" value="/login.do?s=logout" />
		<beans:constructor-arg index="1">
			<beans:list>
				<beans:ref bean="securityContextLogoutHandler" />
				<beans:ref bean="userLogoutHandler" />
			</beans:list>
		</beans:constructor-arg>
	</beans:bean>

	<beans:bean id="securityContextLogoutHandler"
		class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler" />
	<beans:bean id="userLoginHandler"
		class="com.realtech.socialsurvey.web.handler.UserLoginHandler" />
	<beans:bean id="userLogoutHandler"
		class="com.realtech.socialsurvey.web.handler.UserLogoutHandler" />
</beans:beans>